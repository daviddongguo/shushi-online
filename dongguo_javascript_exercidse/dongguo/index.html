<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Sushi Expert</title>
	<link rel="icon" type="image/x-icon" href="favicon.ico" />
	<script type="text/javascript" src="script.js"></script>
	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.css" />
	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

	<!-- Compiled and minified JavaScript -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

<body>

	<div>
		<h2>Exrs 1 : check Prime</h2>
		<h6 id="primeMsg">Please enter an integer</h6>
		<input id="checkPrimeButton" type="text" onchange="checkPrime()">
	</div>
	<div>
		<h2>Exrs 2 : Registration from</h2>
		<div>
			<h6 id="registrationMsg">Please register</h6>

			<label for="email">email:</label><br>
			<input type="text" id="email" value="email@email.com"><br>
			<label for="password">password:</label><br>
			<input type="text" id="password" value="*.*">
			<input id="registerButton" type="submit" onclick="register()" value="Register">
		</div>
	</div>

	<div>
		<h2>Exrs 3 : print fibonacci on console</h2>
		<input type="button" value="print fibonacci" onclick="printFibonacci(15)">
	</div>

	<div>
		<h1 id="msg">hi, there</h1>
		<h3>This is an input</h3>
		<input id="myNumber" type="text" onchange="numberChanged()" oninput="numberChanging()">
		<p>This is a paragraph.</p>
		<input type="submit" text="click me" onclick="submitClicked()">
		<hr>
		<div>
			<label for="number1">number 1:</label><br>
			<input type="text" id="number1" value="9"><br>
			<label for="number2">number 2:</label><br>
			<input type="text" id="number2" value="3">
			<input type="submit" onclick="multiplyClicked()" value="Multiply">
			<input type="submit" onclick="divideClicked()" value="Divide">
			<input type="submit" onclick="addClicked()" value="Add">
			<input type="submit" onclick="subtractClicked()" value="Subtract">
		</div>
		<div>
			<h3>The result is: </h3>
			<h3 id="result">...</h3>
		</div>


		<div>
			<form id="image-upload-form" method="POST" enctype="multipart/form-data">
				<div>
					<label for="name">Name</label>
					<input type="text" name="name" id="name" value="name" required>
				</div>
				<div>
					<label for="description">Description</label>
					<input type="text" name="description" value="description" id="description">
				</div>
				<div>
					<label for="image">Image</label>
					<input type="file" name="file" id="file" required>
				</div>
				<img src="" alt="" />
				<button type="submit">Upload</button>
			</form>
		</div>

	</div>

	<div>
		<img src="" alt="" id="img">
		<button onclick="getImage()">get image</button>
	</div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.1/axios.min.js"></script>


	<script>

		function getImage() {
			var xhr = new XMLHttpRequest();
			xhr.open("POST", "http://localhost:8080/images/2/view", true);

			// Set any required headers or tokens for authentication or authorization
			// xhr.setRequestHeader("Authorization", "Bearer " + token);

			// Set the responseType to indicate binary data
			xhr.responseType = "arraybuffer";

			xhr.onload = function (event) {
				if (xhr.status === 200) {
					// Create a new Blob object from the binary data received in the response
					var blob = new Blob([xhr.response], { type: "image/jpeg" });

					// Read the data from the Blob object using FileReader
					var reader = new FileReader();
					reader.readAsDataURL(blob);
					reader.onload = function () {
						// Display the image in your application or client using an appropriate image viewer or display method
						var img = document.createElement("img");
						img.src = reader.result;
						document.body.appendChild(img);
					};
				} else {
					console.log("Error loading image.");
				}
			};

			// Set the value of {id} to the ID of the image you want to view
			xhr.send(null);

		}

		var file;
		var formData


		var el = document.getElementById("file")
		el.addEventListener('change', function (e) {
			//1.可以通过this拿到这个file的DOM元素
			console.log(this)
			//1.  e 函数事件参数对象中也有这个file的DOM元素对象。使用e.target也可以直接拿到
			console.log(e.target)
			//对开发人员屏蔽，所以直接 必须调用这个文件的DOM对象的files属性，返回一个数组
			let files = e.target.files
			console.log(files)
			// console.log(files.item(0))
			// console.log(files[0])
			// 判断一手是否有文件
			if (!files.length) return
			// 上传文件 创建FormData

			file = files[0]
			previewFile(files[0])
			formData = new FormData()
			// upFile就是后台接收的key

			formData.append('name', 'name')
			formData.append('description', 'name')
			formData.append('file', files[0], files[0].name)
			// 将formdata发送到后台即可
			// 我用的 axios.post('url', formData)
			console.log(formData)
			axios({
				method: "post",
				url: "http://localhost:8080/images",
				data: formData,
				headers: { "Content-Type": "multipart/form-data" },
			})
				.then(function (response) {
					//handle success
					console.log(response);
				})
				.catch(function (response) {
					//handle error
					console.log(response);
				});

		})


		function previewFile(file) {
			let reader
			if (file) {
				// 创建流对象
				reader = new FileReader()
				reader.readAsDataURL(file)
			}
			// 捕获 转换完毕
			reader.onload = function (e) {
				// 转换后的base64就在e.target.result里面,直接放到img标签的src属性即可
				document.querySelector('img').src = e.target.result
			}
		}


		document.getElementById('image-upload-form').addEventListener('submit', function (event) {
			event.preventDefault(); //prevent form submit
			var xhr = new XMLHttpRequest();
			xhr.open('POST', 'http://localhsot:8080/images', true);
			xhr.onload = function () {
				if (xhr.status === 200) {
					console.log('Image uploaded successfully!');
					// Do something on a successful image upload
				} else {
					console.log('Image upload failed: ' + xhr.responseText);
					// Do something on a failed image upload
				}
			};
			console.log(formData)
			xhr.send(formData);
		});


	</script>
</body>

</html>
